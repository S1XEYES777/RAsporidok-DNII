<!DOCTYPE html>
<html lang="ru">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
  <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
</head>

<body class="bg-soft">
<div class="container py-3">

  <div class="d-flex justify-content-between align-items-center mb-2">
    <a href="/main" class="btn btn-outline-secondary btn-sm">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
    {% if me.is_admin %}
      <a href="/admin" class="btn btn-outline-dark btn-sm">Admin</a>
    {% endif %}
  </div>

  <div class="card p-3 mb-3 text-center">

    {% if me.avatar %}
      <img src="data:image/png;base64,{{ me.avatar }}" class="avatar-large mx-auto" alt="avatar">
    {% else %}
      <img src="{{ url_for('static', filename='avatars/default.png') }}" class="avatar-large mx-auto" alt="avatar">
    {% endif %}

    <h4 class="mt-2 mb-2">{{ me.name }}</h4>

    {% if request.args.get('err') == 'taken' %}
      <div class="alert alert-warning py-2">–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ.</div>
    {% elif request.args.get('err') == 'empty' %}
      <div class="alert alert-warning py-2">–ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.</div>
    {% endif %}

    <form method="POST" action="/profile/change_name" class="mb-3">
      <input name="name" class="form-control mb-2" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
      <button class="btn btn-outline-primary w-100">–°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
    </form>

    <div class="progress mb-3">
      <div class="progress-bar" style="width: {{ progress }}%">{{ progress }}%</div>
    </div>

    <form method="POST" action="/profile/upload_avatar" enctype="multipart/form-data">
      <input type="file" name="avatar" class="form-control mb-2" accept="image/*">
      <button class="btn btn-primary w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
    </form>

  </div>

  <div class="card p-3 mb-3">
    <h5 class="mb-3">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h5>

    <form method="POST">
      <input name="text" class="form-control mb-2" placeholder="–¢–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏..." maxlength="220" required>
      <input type="date" name="date" class="form-control mb-2" required>

      <div class="difficulty-select mb-2">
        <button type="button" class="diff-btn diff1" data-level="1">–õ–µ–≥–∫–æ</button>
        <button type="button" class="diff-btn diff2" data-level="2">–ù–æ—Ä–º</button>
        <button type="button" class="diff-btn diff3 active" data-level="3">–°—Ä–µ–¥–Ω–µ</button>
        <button type="button" class="diff-btn diff4" data-level="4">–°–ª–æ–∂–Ω–æ</button>
        <button type="button" class="diff-btn diff5" data-level="5">–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ</button>
        <button type="button" class="diff-btn diff6" data-level="6">–ù–µ–≤–æ–∑–º–æ–∂–Ω—ã–π</button>
      </div>

      <input type="hidden" name="difficulty" id="difficultyInput" value="3">
      <button class="btn btn-success w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
  </div>

  <div class="card p-3">
    <h5 class="mb-2">–í—Å–µ –º–æ–∏ –∑–∞–¥–∞—á–∏</h5>

    {% if tasks %}
      {% for t in tasks %}
        <div class="task diff{{ t.difficulty }}">
          <div class="me-2">
            <div class="fw-semibold">{{ t.text }}</div>
            <div class="small text-muted">{{ t.date }}</div>
          </div>

          <div class="d-flex align-items-center gap-2">
            {% if t.completed %}
              <span class="badge text-bg-success">‚úÖ</span>
            {% endif %}

            <a href="/profile/toggle/{{ t.id }}" class="btn btn-sm btn-outline-success">
              {{ "–°–Ω—è—Ç—å" if t.completed else "–í—ã–ø–æ–ª–Ω–∏—Ç—å" }}
            </a>

            <a href="/profile/delete/{{ t.id }}" class="btn btn-sm btn-outline-danger">
              –£–¥–∞–ª–∏—Ç—å
            </a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="text-muted">–ü–æ–∫–∞ –∑–∞–¥–∞—á –Ω–µ—Ç.</div>
    {% endif %}
  </div>

  <div class="pb-5"></div>
</div>

<nav class="navbar fixed-bottom bg-white border-top">
  <div class="container d-flex justify-content-around py-2">
    <a class="nav-link fw-semibold" href="/main">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a class="nav-link fw-semibold" href="/profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
  </div>
</nav>

<script>
  // –≤—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ)
  const input = document.getElementById("difficultyInput");
  document.querySelectorAll(".diff-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".diff-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      input.value = btn.dataset.level;
    });
  });
</script>

</body>
</html>
